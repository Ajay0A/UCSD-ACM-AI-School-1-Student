# CIFAR-10 Image Classification Competition

Welcome to the ACM AI Workshop! This competition challenges you to build a robust image classifier for the CIFAR-10 dataset.

## 📁 Files Overview

### You'll Use These:

- **`main.py`** - Training script (train/val/test on CIFAR-10)
- **`kaggle_submission.py`** - Generate Kaggle submission from trained model
- **`model.py`** - Define your CNN architecture here
- **`dataset.py`** - Data loading and augmentation
- **`cifar10_competition_starter.ipynb`** - Explore data and experiment
- **`fashion_mnist_demo.ipynb`** - Example workflow on Fashion-MNIST

### Competition Files (Download from Kaggle):

- **`test.csv`** - List of test image IDs to predict
- **`test_images/`** - Folder with test images (00000.png, 00001.png, ...)
- **`sample_submission.csv`** - Template for submission format

### Generated Files:

- **`best_model.pth`** - Your best trained model (saved by main.py)
- **`submission.csv`** - Your predictions (generated by kaggle_submission.py)

---

## 🚀 Quick Start

### 1. Install Dependencies

```bash
pip install torch torchvision pandas pillow tqdm matplotlib scikit-learn
```

### 2. Explore the Data

Start with the Jupyter notebook to understand the dataset:

```bash
jupyter notebook cifar10_competition_starter.ipynb
```

### 3. Train Your Model

Run the training script to train on CIFAR-10:

```bash
python main.py
```

With custom parameters:

```bash
python main.py --epochs 20 --batch_size 128 --lr 0.001 --val_split 0.1
```

This will:
- Train your model on CIFAR-10 training data
- Validate and save the best model as `best_model.pth`
- Show final test accuracy on CIFAR-10 test set

### 4. Generate Kaggle Submission

After training, generate predictions for the competition:

```bash
python kaggle_submission.py
```

This will:
- Load your `best_model.pth`
- Read `test.csv` to get image IDs
- Load images from `test_images/` folder
- Generate predictions and save to `submission.csv`

### 5. Submit to Kaggle

Upload `submission.csv` to Kaggle to see your score!

---

## 📊 Workflow Explained

### Step 1: Train (main.py)

```
CIFAR-10 Data (50K train)
         ↓
    main.py trains model
         ↓
    best_model.pth saved
         ↓
    Test on CIFAR-10 (10K test)
         ↓
    Shows accuracy (development metric)
```

**Command:** `python main.py --epochs 20`

**Output:**
```
Train - Acc: 0.8234, Loss: 0.4123
Val   - Acc: 0.7856, Loss: 0.5234
✓ Saved best model (val_acc: 0.7856)
...
Test Accuracy: 0.7645
```

### Step 2: Generate Submission (kaggle_submission.py)

```
test.csv              test_images/        best_model.pth        submission.csv
┌──────────┐         ┌──────────────┐        ┌────────┐         ┌────────────────┐
│ id       │         │ 00000.png    │        │        │         │ id    │ label  │
│──────────│  ──→    │ 00001.png    │  ──→   │  CNN   │  ──→    │───────│────────│
│ 00000    │  read   │ 00002.png    │  load  │        │  pred   │ 00000 │ cat    │
│ 00001    │   IDs   │ ...          │  imgs  │        │  ict    │ 00001 │ dog    │
│ 00002    │         │ 09999.png    │        │        │         │ ...   │ ...    │
└──────────┘         └──────────────┘        └────────┘         └────────────────┘
```

**Command:** `python kaggle_submission.py`

**Output:**
```
Generating predictions from test_images/
Total predictions: 10000
Submission saved to: submission.csv

You can now upload 'submission.csv' to Kaggle!
```

---

## 🛠️ Customization Guide

### 1. Improve Your Model (`model.py`)

The default `SimpleCNN` is just a baseline. Create your own:

```python
class MyBetterCNN(nn.Module):
    def __init__(self, num_classes=10):
        super().__init__()
        # Your architecture here
        self.features = nn.Sequential(
            # Add layers...
        )
        self.classifier = nn.Sequential(
            # Add classifier...
        )

    def forward(self, x):
        x = self.features(x)
        x = x.view(x.size(0), -1)
        x = self.classifier(x)
        return x

# Update get_model() to use your model
def get_model(num_classes=10):
    return MyBetterCNN(num_classes=num_classes)
```

### 2. Add Data Augmentation (`dataset.py`)

**This is KEY to winning!** The Kaggle test set has challenging augmentations:

```python
def get_transforms(augment=False):
    if augment:
        return transforms.Compose([
            transforms.RandomCrop(32, padding=4),
            transforms.RandomHorizontalFlip(),
            transforms.ColorJitter(0.2, 0.2, 0.2),      # NEW!
            transforms.RandomRotation(15),               # NEW!
            transforms.ToTensor(),
            transforms.Normalize((0.4914, 0.4822, 0.4465),
                               (0.2470, 0.2435, 0.2616)),
        ])
```

### 3. Customize Model Saving (`main.py`)

By default, the best model is saved based on highest validation accuracy. You can change this in the `save_best_model()` function:

```python
def save_best_model(model, val_acc, best_val_acc, checkpoint_path):
    """Save model based on your criteria"""
    # Option 1: Highest validation accuracy (default)
    if val_acc > best_val_acc:
        best_val_acc = val_acc
        torch.save(model.state_dict(), checkpoint_path)
        print(f"✓ Saved best model (val_acc: {best_val_acc:.4f})")

    # Option 2: Lowest validation loss (uncomment to use)
    # if val_loss < best_val_loss:
    #     best_val_loss = val_loss
    #     torch.save(model.state_dict(), checkpoint_path)

    return best_val_acc
```

### 4. Command Line Options

**Training (`main.py`):**
```bash
python main.py \
  --epochs 20 \              # Number of training epochs
  --batch_size 128 \         # Batch size
  --lr 0.001 \              # Learning rate
  --val_split 0.1 \         # Validation split ratio
  --checkpoint best_model.pth  # Where to save best model
```

**Submission (`kaggle_submission.py`):**
```bash
python kaggle_submission.py \
  --model best_model.pth \           # Trained model checkpoint
  --test_csv test.csv \             # Test image IDs
  --test_images_dir test_images \   # Test images folder
  --output submission.csv            # Output file
```

---

## 📈 Understanding the Output

### Training (main.py)

```
Epoch 1/10
Training: 100%|████████████| 391/391
Validating: 100%|██████████| 40/40
Train - Acc: 0.6234, Loss: 1.0543
Val   - Acc: 0.5876, Loss: 1.1234
✓ Saved best model (val_acc: 0.5876)

...

============================================================
FINAL TEST RESULTS
============================================================
Test Accuracy: 0.7234
Test Loss:     0.8123
============================================================

Training complete! Best model saved to: best_model.pth
```

**Note:** Test accuracy is shown for CIFAR-10 test set (development purposes)

### Submission Generation (kaggle_submission.py)

```
Loading model from: best_model.pth
Model loaded successfully!

Reading test data from: test.csv
Found 10000 images to predict

Generating predictions from test_images/
Predicting: 100%|████████████| 10000/10000

============================================================
SUBMISSION GENERATED
============================================================
Total predictions: 10000
Submission saved to: submission.csv

Submission preview:
      id     label
0  00000  airplane
1  00001      frog
2  00002      ship
...

You can now upload 'submission.csv' to Kaggle!
============================================================
```

**Note:** NO accuracy is shown (you don't have labels for Kaggle test set!)

---

## 🎯 Tips for Success

### 1. **Data Augmentation is Your Best Friend**

The Kaggle test set has noise, blur, color shifts, and other augmentations. Train with augmentations to improve generalization!

### 2. **Iterate Quickly**

```bash
# Quick test (2 epochs)
python main.py --epochs 2 --batch_size 256

# If it works, train longer
python main.py --epochs 30 --batch_size 128

# Generate submission
python kaggle_submission.py
```

### 3. **Monitor Overfitting**

If training accuracy >> validation accuracy, you're overfitting:
- Add more augmentation
- Add dropout
- Reduce model complexity

### 4. **Use the Notebook for Experimentation**

Test ideas in `cifar10_competition_starter.ipynb` before modifying the Python files.

### 5. **Don't Trust CIFAR-10 Test Accuracy Alone**

Your model might get 75% on CIFAR-10 test but only 60% on Kaggle. Why? The Kaggle test set is augmented! This tests generalization.

---

## 🏆 Submission Format

Your `submission.csv` must have exactly 2 columns:

```csv
id,label
00000,airplane
00001,automobile
00002,bird
...
```

**Valid labels:** `airplane`, `automobile`, `bird`, `cat`, `deer`, `dog`, `frog`, `horse`, `ship`, `truck`

---

## 🐛 Troubleshooting

### "test.csv not found"

Download `test.csv` from Kaggle and place it in the project directory.

### "Test images directory not found"

Download and unzip `test_images.zip` from Kaggle:
```
project/
├── main.py
├── kaggle_submission.py
├── test.csv
└── test_images/
    ├── 00000.png
    ├── 00001.png
    └── ...
```

### "best_model.pth not found"

You need to train first:
```bash
python main.py --epochs 10
```

This creates `best_model.pth`, which you can then use:
```bash
python kaggle_submission.py
```

### "CUDA out of memory"

Reduce batch size:
```bash
python main.py --batch_size 64
```

### Low Kaggle accuracy despite high CIFAR-10 accuracy

Your model is overfitting to clean images! Add more augmentation in `dataset.py`.

---

## 📚 Resources

- **CIFAR-10 Official:** https://www.cs.toronto.edu/~kriz/cifar.html
- **PyTorch Tutorial:** https://pytorch.org/tutorials/beginner/blitz/cifar10_tutorial.html
- **Data Augmentation Guide:** https://pytorch.org/vision/stable/transforms.html

---

## 🤝 Getting Help

- Check the competition discussion forum on Kaggle
- Ask in the ACM AI Discord/Slack
- Review `fashion_mnist_demo.ipynb` for a complete example workflow

---

## 📝 Summary

```bash
# 1. Train your model
python main.py --epochs 20

# 2. Generate Kaggle submission
python kaggle_submission.py

# 3. Upload submission.csv to Kaggle!
```

Good luck, and may your gradients be ever in your favor! 🚀

